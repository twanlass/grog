# Prompt Build Log

This documents the prompts used to build this project with Claude.

---

## 1. User prompt
> we're building a simple sim game using Kaplay as our game engine (https://kaplayjs.com/docs/guides/). I've put together a game design doc (game-design-doc.md). Review that first. Lets then make a plan. I'd suggest creating a todo.md file to track our progress. Suggest first steps: get Kaplay setup and render hello world on the screen. Next, maybe we start working on the hex map generation. 

## 2. User prompt
> lets refactor sprites.js into files for ships and ports. Do whatever Kaplay docs suggest is best practice

## 3. User prompt
> let's implement a fog of war mechanic. Here's how it should work: 
1. At game start, shroud the entire map in blackness (fog)
2. Expose (hide fog) a 1 hex radius around every ship and port
3. As ships sail, expose 1 hex radius of fog around the ship 
4. Fog should remain exposed

## 4. User prompt
> update the visuals for the path rendered to be a dashed orange line isntead of solid red

## 5. User prompt
> can we experiment with having the ships rotate to face the direction they are heading? 

## 6. User prompt
> let's document features so that future coding work is faster for our LLM. To start: 
1. create a new directory in our project
2. document our fog of war feature. keep it short and sweet. include paths to relevant files. write it in markdown so an LLM (claude code) can read it. 
3. update or create our .claude file for this project to include a reference to our new directory and markdown feature files

## 7. User prompt
> let make the the background pitch black (the part beyond the hexes) so the end of the world is visually obvious

## 8. User prompt
> let's work on a new feature: building ships! We'll start simple: 
1. when a port is selected, we should show a simple UI that lists the type of boats that port can build (see #### Port Progression in game-design-doc.md)
2. when clicking on the UI for a specific ship, show a progress bar above the port (progress bar should use the `build_time` specfied in game/src/sprites/ships.js
3. when progress bar is complete, add a ship in the ocean near the port on an availble free hex
4. don't worry about ecnomoy / resources yet. 

## 9. User prompt
> how big is the map?

## 10. User prompt
> can we make it 60x60? 

## 11. User prompt
> replace our starting port with a Stronghold

## 12. User prompt
> let's update our fog of war mechanic to take into account the ship and it's specific `sight_distance` for uncovering fog/map. Read about the mechanic in docs/features/fog-of-war.md first. Then update the feature to expose more of the fog based on the ship. 

## 13. User prompt
> lets experiment with updating our controls: 
Instead of command + left click to set a waypoint, lets use just left cilck _when_ a ship unit(s) is selected. This should make basic nav easier.   

## 14. User prompt
> one more logic change: 
after a way point has been set, the next left click should clear the selection instead of setting another waypoint

## 15. User prompt
> update the waypoint visual marker from a red square to a chunky red x (like an x marks the spot on a pirate map!)

## 16. User prompt
> one more logic update to waypoints; if a ship is selected and it's reached its waypoint, the next left click should set a new waypoint, not unselect the ship

## 17. User prompt
> can we add a little texture to the tiles? I'm thinking for each tile type, choose 3 similar colors (so for deep water, pick 3 deep blues) and then use that to stiple the hex tile. 

## 18. User prompt
> rendering is much much slower. Shoudl we pre-calc the stiple and use components? Just render instances? 

## 19. User prompt
> let's document our ship construction feature in docs/features

## 20. User prompt
> let's implement a port building feature. 
1. Ports can be built when a ship is "docked" (on a shore hex, water adjacent to land)
2. When a ship is docked and selected, show a build menu (bottom left)
3. Build menu should only show the first port type in the tech tree
4. Once a menu item is chosen, we want to activate a selection mode: allow the user to hover over hexs of the docked landmass; on hover, highlight the hovered hex; 
5. On click (ports can only be built on shore line hex), place the port sprite and show a progress bar indicating it's `buildTime`. 
6. Once complete, the port can be selected and ships may be built from it. 

## 21. User prompt
> lets update the port selection to only allow hexs within 5 of the boat to be selected (so that a boat can't build a port across the map lol)

## 22. User prompt
> one more update – don't clear any fog of war until the port has successfully been completed / built 

## 23. User prompt
> let's document port building in /docs/features. Focus on behavior, key files, key functions. Don't
  worry about documenting variable values (like buildTime etc) as those change.  

## 24. User prompt
> next, lets add support for upgrading your port: 
1. When a user selects a port (must be complete, not in a building state), show an upgrade menu (bottom left)
2. Options should include only the next available port type in the tech tree
3. Once selected, show the build progress bar and use the `buildTime` of the upgraded port

## 25. User prompt
> a few small tweaks: 
1. while first construction a port, don't allow the ship that initiated it to move
2. Don't allow the ship that initiated to build another port (only one at a time)

## 26. User prompt
> cool. update the port building docs

## 27. User prompt
> let's implement a new unit type: farm. 
1. Read up on how ports work: docs/features/port-building.md
2. Farms can be built from Ports. Much like building a port from a ship: 
2a. select a port
2b. show it's menu (today has options to build ships or upgrade)
2c. add a new option to build a farm
3. when farm is selected, intialize the hex selection mode (green)
4. Allow the player to select any contiguous land hex within 10 hex of the port
5. when chosen, build a farm on the selected hex

## 28. User prompt
> make sure that building farms and ships and outputs uses the same progress bar 

## 29. User prompt
> make sure that building farms and ships and outputs uses the same progress bar ui / visual  

## 30. User prompt
> let's tidy up units a bit: 
1. rename outpost to dock
2. rename sloop to schooner

## 31. User prompt
> update our starting state to: 
1. a port instead of a stronghold
2. place 2 farms near by
3. give us just one cutter 

## 32. User prompt
> let's add a new economoy feature. To start, let's add some build costs to our units: 
1. Ships and ports should require wood to be built. Stub in some values and I'll tweak them code

## 33. User prompt
> let's introduce a new mechanic: collecting resources from foreign ports
1. Foreign ports already collect resources from thier nearby settlements
2. Let's allow for a foreign port to be a waypoint selection; with a ship selected, left click a foriegn port to target it. 
2a. the selected ship will navigate to the foriegn port
2b. the selected ship will load up wood and food 
2c. loading wood and food should take 0.25 seconds per wood and food unit loaded, up to the maximum `cargo` of the selected ship
2d. show a loading progress bar above the ship
3. once loaded, the selected ship will navigate back to the home port and unload.
4. once unloaded, the ship will wait for it's next orders   

## 34. User prompt
> confirm that the resources loaded are deducted from the foreign port and when unloaded are added to the global store. Also increase load/unload time to 1s per resource 

## 35. User prompt
> update the default home port to have no settlements intially 

## 36. User prompt
> two small updates: 
1. when selecting a boat, show a menu bottom right that lists it's name and any cargo it's carrying (wood or food count) 
2. if a ship is carrying cargo and the user clicks on the home port, navigate the ship to the home port and unload it (right now if the auto route is interupted, the ship can't be unloaded)

## 37. User prompt
> how might we support some sort of waiting retry system for ships that are trying to load/unload by find their waypoint busy / in use by another ship? 

## 38. User prompt
> option b! 

## 39. User prompt
> let's make a plan to refactor game/src/scenes/gameScene.js – it's getting quite large. 

## 40. User prompt
> I think we need to fix our git repo; it looks like just the game directory is included/tracked but we need /Users/tylerwanlass/code/grog to be tracked included. What should we do? 

## 41. User prompt
> git push 

## 42. User prompt
> ls

## 43. User prompt
> can you create a simple readme.md in the root? Quick summary of the project, list out docs/features, and a quick how to run 

## 44. User prompt
> yes

## 45. User prompt
> update all copy, comments, code, to replace references to "farms" with " settlements"

## 46. User prompt
> let's update our sea bird: 
1. Increase it's path radious around the home port
2. Have it point / rotate to follow the path direction. By default, the sprite is draw at a 45 degree angle with the nose of the bird pointed top right
3. spawn 3 birds with thier size variying up to 305% smaller than default size. Have them spread out 

## 47. User prompt
> almost there; the individual bird though isn't rotating locally to face forward and follow it's path

## 48. User prompt
> the angle may be off; the sprite for the bird is drawn at a 45 degreen angle 

## 49. User prompt
> here's a visual: 
1. Red circle is the current path (orbit)
2. blue arrow is the direction the bird is currently facing (wrong)
3. yellow arrow is the direction the bird _should_ be facing

## 50. User prompt
> still not right: heres the bird for reference (yellow arrow is current facing direction) 

## 51. User prompt
> try 150 degree offset

## 52. User prompt
> that's perfect 

## 53. User prompt
> we're going to implement a new feature + mechanic: pirate ships! We'll start simple: 
1. Create a new ship type, "pirate"; use the Schooner as a template to start. 
2. Modify the ships sails to be black w/ a white dot in the middel (simple pirate skull flag)
3. spawn the ship in the ocean near the home port

## 54. User prompt
> Now let's start turning the pirate ship into an AI player: 
1. Don't allow the user to select it (user can't control it)
2. Have the pirate ship generate a simple path around the home port and auto-navigate

## 55. User prompt
> lets expand it's patrol distance by 3x 

## 56. User prompt
> document our pirate in docs/features

## 57. User prompt
> let's improve our pirate ship AI a bit: 
1. 4 possible states: patrol, chase, attack, retreat
1a. patrol - what it does today (wanders around)
1b. chase - when a player ship or port comes within a distance of 8 hex, it should pick it as a waypoint target. Make `enemySightDistance` a ship const for tweaking later. 
1c. attack - once the pirate ship is within `attackDistance`, it should stop and begin firing. For now do nothing; we'll implement attack feature next. 
1d. retreat - the pirate ship should navigate away from the waypoint target, and then after a cooldown, start patrol again. Make `retreatCooldown` a const for tweaking later. 
2. let's make pirate ships selectable again so that the player can see their current state (patrol, chase, etc). Use the same bottom right UI we show for when selecting any other ship. 

## 58. User prompt
> because the pirate ship spawns so close to the home port its in attack mode right away. can we spawn it farther away? 

## 59. User prompt
> a few improvements: 
1. Let's add a `maxChaseDistance`; something like 20 hexs to avoid a pirate following a ship across the world lol 

## 60. User prompt
> let's change how maxChaseDistance works – treat this as a chanse distance value, as in, if the pirate ship has chased the player for 20 hex and still not entered attack mode, revert to patrol mode

## 61. User prompt
> it looks like once the pirate ship reaches a max chase distance it stops moving but remains in chase mode, and does not return to patrol mode

## 62. User prompt
> to prep for attack battles, let's add a health const to all ships and ports.

## 63. User prompt
> update docs

## 64. User prompt
> update ship `sight_distance` const to be `sightDistance` (fix case) 

## 65. User prompt
> let's prep a commit 

## 66. User prompt
> we're going to add our attack mechanic for pirate ships. While in the attack state: 
1. ships should shoot a cannon ball towards their waypoint target
2. there should be a simple ~5 second cooldown between shots
3. no ammo constraints for now
4. each cannon ball, when hitting it's target, should deduct 5 health
5. all ships and ports will need a destroyed state (when health <= 0)
5a. destroyed state should destroy the instance of the item. 
5b. todo: we'll need to solve for the edge case where a port is destroyed - what should happen to it's settlements? 

## 67. User prompt
> in ports.js, let's rename "port" to "shipyard". update any refs in code if needed. 

## 68. User prompt
> lets spawn a few more pirates at game start (3 total)

## 69. User prompt
> lets spawn just 2 pirates. make this configurable. 

## 70. User prompt
> after a pirate is destroyed, respwan one after a 30 second cooldown 

## 71. User prompt
> let's make a simple end state: 
if all player ships and all ports have been destroyed restart the game

## 72. User prompt
> let's add a 60 second wait before we first spawn pirates 

## 73. User prompt
> let's make combat a little more interesting. When a unit is hit with a cannon ball, have it quickly flash to indicate it's been hit

## 74. User prompt
> let's add a const to ships to control their fire speed. Larger ships should fire more frequently. 

## 75. User prompt
> let's replace our cutter with an actual sprite. I've added a sprite asset (one frame): game/src/sprites/assets/cutter.png. The sprite ship is facing up / north. 

## 76. User prompt
> next, let's have the ship rotate and face the direction it's headed. Since this is a hex based game, we'll have 6 possible directions. 

## 77. User prompt
> it's close. let's use 45 degree angles for the hex directions

## 78. User prompt
> the ship is quite large. Can we adjust it's size? where is that constant so I can edit it? 

## 79. User prompt
> can we refactor things and consolidate a single scale in the ship const metadata? have flash use that etc? 

## 80. User prompt
> the cutter isn't flashing when hit by a cannonball. Can we add that back?

## 81. User prompt
> hmmm. can I add a flash state to the sprite instead? that way it matches the ship outline etc?

## 82. User prompt
> okay, I added a second frame for the flashing state

## 83. User prompt
> last bit of flourish: cannonballs have a nice arc. When they reach their peak of the arc, let's increase the cannonball size by 1.2x (so it appears to come closer to the camera)

## 84. User prompt
> have them scale/start from 0.8

## 85. User prompt
> for land units (ports, settlements) let's update the selection state: instead of a yellow circle around the unit, let's outline the hex it's placed on (yellow outline around the hex). Similar to the selection mode for placing a settlement or port (hex outline in green)

## 86. User prompt
> lets update the other units to use the same selection style (hex outline)

## 87. User prompt
> for ships (units that move), only show the hex outline when stationary. 

## 88. User prompt
> something happened w/ the waypoint line; when selecting a destination for a ship, it now draws a line waaaaay off the map as as well as to the desination 

## 89. User prompt
> when targeting a pirate ship, instead of showing the x waypoint, let's highlight the pirate ship by using the same hex outline, but in red (to indicate we're attacking)

## 90. User prompt
> apply the same logic to the pirate ship hex outline – only show it when the pirate ship comes to rest

## 91. User prompt
> clear

## 92. User prompt
> we're going to add a new unit type: towers! 
1. Towers can be built by ships much like ports 
2. Towers can be placed like settlements (selection mode, etc)
3. Towers can be attacked by pirates (this should already be generalized in that pirates attack any player units
4. Towers once built, should attack pirate ships automatically.

## 93. User prompt
> clear

## 94. User prompt
> let's find some refactoring opportunities for gameScene.js, it's getting quite large 
