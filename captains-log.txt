CAPTAIN'S LOG
=============

2026-01-11 | Add action buttons for ship and port commands
----------------------------------------------------------
### New
- Action buttons (Move, Attack, Patrol) appear when ships are selected
- Rally button appears when ports are selected (no ships)
- Hotkeys M, A, P, R for Move, Attack, Patrol, Rally modes
- Guard mode: ships navigating via Attack button auto-attack nearby enemies
- Attack cursor shown when in attack mode

### Improved
- Patrol mode now cancels when clicking on another unit (instead of adding waypoint)

### Fixed
- Escape key now deselects units when exiting patrol mode


2026-01-10 | Fix patrol ship movement snapping when engaging enemies
---------------------------------------------------------------------
### Fixed
- Patrol ships now smoothly transition to chase instead of snapping when detecting enemies
- Ships complete their current movement interpolation before recalculating path


2026-01-10 | Improve group pathfinding with flow-based movement
----------------------------------------------------------------
### New
- Distributed destination assignment spreads ships around waypoint target
- Predictive reservation system prevents collision before it happens
- Soft-cost pathfinding makes ships flow around each other naturally
- Conflict detection and resolution for simultaneous movement

### Improved
- Ships travel in parallel paths using angle-based destination matching
- Single waypoint marker at click location instead of per-ship markers
- Title screen difficulty/opponent buttons centered under Skirmish card
- Removed gray backgrounds from ship selection tray
- Increased title screen button height by 4px


2026-01-10 | Make ship explosions more dramatic
-----------------------------------------------
### Improved
- Larger explosion radius with expanding shockwave ring
- Varied fire particle colors (yellow-orange, orange-red, deep red)
- Rising smoke particles after initial blast
- Longer explosion duration (0.6s to 1.0s)
- Stronger camera shake with slower decay


2026-01-10 | Add selectable AI opponent count for versus mode
-------------------------------------------------------------
### New
- AI opponent selector (1-3) for versus mode with dropdown UI
- Dropdown menus for difficulty and opponent count (similar to speed selector)

### Improved
- Dynamic AI initialization based on selected count
- Difficulty and opponent dropdowns appear below Skirmish card when selected


2026-01-09 | Fix fog revealing unexplored areas in versus mode
--------------------------------------------------------------
### Fixed
- AI ships and pirates no longer reveal fog of war when firing in unexplored areas
- Fog is now only revealed by the player's own units and structures


2026-01-07 | Add AI difficulty selector and tune AI/pirate behavior
--------------------------------------------------------------------
### New
- AI difficulty selector (Easy/Normal/Hard) for versus mode
- Difficulty scales decision speed, ship caps, aggression, and economy growth

### Improved
- Delayed pirate spawning in versus mode (3 minutes before first spawn)
- Extended pirate respawn cooldown (90 seconds between respawns)
- AI now defends against pirates (towers attack pirates, ships target them)
- AI receives threat notifications when structures are attacked
- Reduced AI plunder frequency for more strategic gameplay

### Fixed
- Audio no longer plays on every click when changing difficulty
- Crash in patrol auto-attack when spatial index has stale references


2026-01-07 | Optimize fog rendering: skip unexplored hexes
----------------------------------------------------------
### Improved
- Fog culling moved before opacity calculation (avoids expensive checks on off-screen hexes)
- Tiles, decorations, and waves skip rendering under unexplored fog (opaque anyway)
- Removed hatching lines from unexplored fog (reduced draw calls)
- FPS improved from ~20 to 60 when viewing fogged areas


2026-01-07 | Performance optimizations: spatial indexing and caching
---------------------------------------------------------------------
### Improved
- Fog of war visibility calculation now uses cached radius offsets (avoids BFS every frame)
- Shroud animation samples 5 visible hexes instead of all for distance calculation (O(n) vs O(n²))
- Projectile hit detection uses O(1) position lookup map instead of iterating all entities
- Tower attacks and patrol detection use spatial hash index for efficient range queries
- Combat system builds spatial indexes once per frame for all lookups


2026-01-06 | Add combat sounds and AI indicator polish
------------------------------------------------------
### New
- Cannon fire sounds (4 variants) play when ships/towers fire
- Cannon impact sounds (5 variants) play when projectiles hit
- Ship selection sounds (5 variants) play when selecting ships
- Ambient ocean and background music loops during gameplay
- Sound events only play for visible hexes (fog of war aware)

### Improved
- AI faction indicators changed from circles to hexes
- AI indicator colors now match cutter sprites (green for ai1, blue for ai2)
- Cannon fire timing has micro variation (±20ms) to stagger volleys naturally

### Fixed
- Cutters can no longer be built via "C" hotkey while port is upgrading


2026-01-05 | Fix damage flash shader for sprites
------------------------------------------------
### Fixed
- Damage flash effect now works on PNG sprites (ships, ports, towers, settlements)
- Shader passes flash intensity via opacity channel instead of uniforms (Kaplay workaround)


2026-01-05 | Add color-coded directional cutter sprites
--------------------------------------------------------
### New
- Directional cutter sprites with 8-direction support (5 rows + horizontal mirroring)
- Color-coded ships by owner: player (red), ai1 (green), ai2 (blue)
- 3-frame animation cycling for cutter sprites
- Sound assets for game modes and UI clicks

### Improved
- Build menu renders directional sprites with SE-facing frame
- Build queue shows directional sprites instead of pixel art
- Title screen cutter uses animated directional sprite
- Plunder/loading speed reduced to 2 seconds per wood unit


2026-01-04 | Add title screen clouds and music
----------------------------------------------
### New
- Animated clouds on title screen: hex-based puffs with shadow, base, and highlight layers
- Cloud shape-shifting: puffs wobble, pulse, and breathe independently for organic feel
- Title screen music: plays on first user interaction, 10s delay between loops
- Clouds spawn in bottom-left formation and drift to top-right

### Improved
- Title screen copyright layout: cleaner formatting with underlined author link
- Version number added to title screen (v0.05)


2026-01-04 | Fix crew cap, add Schooner dual-shot, ship wake sizes
------------------------------------------------------------------
### New
- Schooner dual-shot: fires two projectiles per volley with staggered delay
- Ship wake size property: each ship now has explicit `wakeSize` for water trails
- Neutral pirates in versus mode: spawn at map center instead of near player
- AI tower building now uses docked ships as builders (not just ports)

### Improved
- Versus mode is now default scenario
- Plundering ships abort and retreat when health drops below threshold
- Stronghold sight distance increased (6→12) and crew cap contribution (20→50)
- Shipyard crew cap contribution increased (20→30)

### Fixed
- Crew cap now correctly calculated per-faction (was summing all factions)
- Cutter water trail size reduced (was using cargo-based formula, now explicit wakeSize)


2026-01-03 | Add AI port expansion and upgrades
-----------------------------------------------
### New
- AI port expansion: AI discovers new islands and sends ships to build ports there
- AI port upgrades: AI upgrades existing ports (dock → shipyard → stronghold)
- Strategy-based expansion rates (Economic expands fastest with shipyards, Aggressive slowest with docks)
- Island discovery system: ships scan for valid port sites within 8-hex sight range

### Improved
- Plundering label: progress bar now shows "PLUNDERING" instead of "LOADING" when looting enemy ports


2026-01-03 | Add AI surrender and minimap attack alerts
-------------------------------------------------------
### New
- AI surrender in versus mode: when AI has only settlements left, they offer surrender
- Accept/Decline dialog lets player choose to end fight or continue playing
- Minimap attack alerts: flashing red X markers when player structures attacked off-screen
- Pulsing red border around minimap during active attacks

### Improved
- Cutter stats: increased attack distance (2→3) and sight distance (1→2)
- Enhanced attack alert visuals with pulsing X markers and thicker border


2026-01-03 | Add multi-port build hotkey with round-robin
----------------------------------------------------------
### New
- Multi-port ship building: select multiple ports and press C to queue ships
- Round-robin distribution: each keypress adds a ship to the next eligible port
- Selection-aware reset: round-robin restarts when port selection changes


2026-01-03 | Fix patrol routes and add build queue
--------------------------------------------------
### New
- Build queue system for ports (max 3 ships per queue)
- Build queue UI panel at bottom center showing active build + queued items
- Click-to-cancel on queue items with red X hover indicator

### Improved
- Player ships now auto-return-fire when attacked by AI players (not just pirates)
- First patrol waypoint replaces existing waypoints to start patrol immediately

### Fixed
- Patrol routes now work correctly for multiple selected ships
- Ships no longer get stuck when patrol waypoints are occupied by other ships
- Ships correctly continue patrol loop when reaching blocked waypoints


2026-01-03 | Add debug fog toggle and fix versus mode issues
------------------------------------------------------------
### New
- Debug panel with "Hide fog of war" toggle (Menu → Debug)
- When enabled, reveals all AI units and full minimap for debugging
- Fair starter island templates for versus mode (3 predefined shapes)
- Support for two AI players (ai1, ai2) in free-for-all versus mode

### Fixed
- AI spawn positions now stay within map bounds (fixed coordinate conversion)
- Player can now attack AI structures in versus mode (fixed owner check)
- Fog visibility checks now correctly identify ai1/ai2 as AI owners


2026-01-02 | Hide AI units in fog of war
----------------------------------------
### New
- `shouldRenderEntity()` helper for automatic fog visibility on new unit types
- AI units (ships, ports, settlements, towers) no longer reveal fog of war

### Improved
- All rendering functions now use centralized fog visibility check
- Effects hidden in fog: trails, projectiles, explosions, splashes, debris, loot, health bars
- Hover highlights skip hidden units in fog
- Victory/defeat screen returns to title instead of restarting


2026-01-02 | Add AI strategy system with tactics
------------------------------------------------
### New
- Three AI strategies: Aggressive (early rush), Defensive (tower fortress), Economic (boom then strike)
- Strategy randomly selected at game start for varied gameplay
- Game phase tracking (early/mid/late) with phase-specific modifiers
- Tactics system: Scout (explore and harass), Group Attack (coordinate ships), Defend (recall when threatened)
- AI tower upgrading with strategy-aware priority
- Debug buttons on versus mode card to test specific AI strategies

### Improved
- Strategy-specific build priorities (towers, settlements, ships)
- Strategy-specific ship behavior (patrol radius, aggression)
- AI decisions now evolve based on game phase


2026-01-01 | Add retro square particles and hexagonal water effects
-------------------------------------------------------------------
### Improved
- Particle effects now use squares for retro aesthetic (trails, explosions, sparkles, debris)
- Water splashes (miss effects) render as expanding hexagons matching the hex grid
- Water rings (sinking ships) render as expanding hexagons
- Cannon balls remain circular for visual contrast


2026-01-01 | Improve UI consistency and panel positioning
---------------------------------------------------------
### Improved
- Moved speed control to top right next to pause button, styled as matching button
- Moved all selected unit panels (ship, tower, settlement) to bottom left for consistency
- Pirate kill counter only shows in defend mode, repositioned to right of wave status
- Pirate kill counter styling: smaller sprite (0.75x), "x N" format, dynamic width
- All docks now render with the home-port PNG sprite

### Fixed
- Fixed panel overlap when ship is docked (build panel vs info panel no longer conflict)


2026-01-01 | Add circular minimap with click-to-navigate
--------------------------------------------------------
### New
- Circular minimap in bottom-right corner showing fog of war state
- Red viewport indicator shows current camera position on minimap
- Click-to-navigate - click anywhere on minimap to snap camera to that location

### Improved
- Minimap only renders explored tiles for performance (unexplored = black background)
- Color caching reduces per-frame computation when fog state unchanged


2025-12-31 | Fix health bars and patrol route behavior
------------------------------------------------------
### Fixed
- Health bars now show correctly on attacked towers, ports, and settlements
- Patrol route uses ship's current destination as first waypoint instead of current position


2025-12-31 | Add AI opponent for versus mode
--------------------------------------------
### New
- AI opponent system - builds ships, ports, settlements, towers like a player
- "Versus AI" game mode with mirror start and total elimination win condition
- Entity ownership system (`owner` field distinguishes player vs AI units)
- AI decision engine with strategic priorities, build evaluation, and ship commands
- AI documentation (docs/features/ai-opponent.md)

### Improved
- Combat system is now owner-aware (no friendly fire, faction-based targeting)
- Ships can attack AI structures (ports, settlements, towers) using `attackDistance`
- Added `attackDistance` property to all ships for data-driven attack range
- `findNearestWaterInRange()` enables targeting structures up to 2 hexes inland
- Red visual indicators distinguish AI-owned units

### Fixed
- Ships now properly navigate to water tiles when attacking inland structures


2025-12-30 | Add patrol routes with auto-attack
-----------------------------------------------
### New
- Patrol routes - press P to enter patrol mode, right-click to add waypoints
- Ships loop through patrol waypoints continuously
- Auto-attack for patrolling ships - detect pirates within sightDistance, engage, then resume patrol
- Patrol documentation (docs/features/patrol.md)

### Improved
- Wave spawner only spawns pirates under fog of war
- Controls menu updated with P (patrol) and "." (pause) hotkeys
- Route lines changed from orange to red for visual consistency
- Menu panel now renders above birds

### Fixed
- Fog of war visibility persists during tower/port upgrades
- Changed pause hotkey from P to "." to free up P for patrol


2025-12-29 | Add multiple waypoint navigation
---------------------------------------------
### New
- Multiple waypoint navigation - Shift + right-click queues additional waypoints
- Ships follow waypoints in order, treating the last as final destination
- Orange dashed A* route line shows full path through all queued waypoints

### Improved
- Waypoint markers now display for all queued waypoints when ship is selected


2025-12-29 | Add tooltips and animated fog of war
-------------------------------------------------
### New
- UI tooltip system for build menu items with word wrapping
- Animated fog of war reveal effect - hexes reveal ring-by-ring from vision source
- Animated fog shroud effect - fog returns with inward ripple when losing visibility
- Tooltips documentation (docs/features/tooltips.md)

### Improved
- Fog transitions smoothly between unexplored, shrouded, and visible states
- Previously unexplored hexes animate from full fog; explored hexes animate from shroud

### Fixed
- Home port upgrade no longer triggers false "defeated" game over in Defend mode


2025-12-29 | new watchtower assets; fog of war updated to be dynamic; settlements can be repaired.
--------------------------------------------------------------------------------------------------
### New
- New watchtower sprite assets (tower.png, watchtower.png)
- Settlement repair functionality - damaged settlements can now be repaired

### Improved
- Fog of war system now updates dynamically as units move
- Enhanced tile rendering with fog of war integration
- Combat system refinements
- Unit and effects rendering improvements


2025-12-28 | hide pathfinding trails; fix enemy selection; make settlements attackable
---------------------------------------------------------------------------------------
### New
- Settlements can now be attacked by enemy ships
- Crew limit notification system with on-screen messages

### Improved
- Pathfinding trails are now hidden for cleaner visuals
- Bird animations have staggered starts and varied orbit radii
- Speed menu can be closed with ESC key

### Fixed
- Enemy ship selection now works correctly


2025-12-28 | build cleanup
--------------------------
### Improved
- Removed unused sprite assets from src/sprites/assets
- Cleaned up vite configuration
- Reduced build size


2025-12-28 | more ui polish
---------------------------
### Improved
- Ship info panel repositioned to center-bottom of screen
- Ship info panel styling (darker background, adjusted opacity)
- Port build panel widened for better layout
- Removed separator lines between panel sections


2025-12-28 | Large UI polish + refactor
---------------------------------------
### New
- Netlify deployment configuration added

### Improved
- Major UI panel refactoring and polish
- Selection UI improvements
- Sprite assets reorganized to public folder
- Gallery scene updates


2025-12-28 | New Crew resource mechanic; lots of sprite updates
---------------------------------------------------------------
### New
- Crew resource mechanic - units now require crew to build
- Settlements provide max crew capacity
- Loot drops from destroyed enemies
- New sprites: barrel, resource icons (crew, wood), settlement

### Improved
- Updated cutter, rally-point sprites
- Combat system enhancements with crew mechanics
- Fog of war updates
- Trade routes simplified


2025-12-27 | Adds unit repair feature. Adds custom rally point sprite
---------------------------------------------------------------------
### New
- Unit repair system - ships and towers can be repaired at ports
- Custom rally point sprite
- Home port sprite

### Improved
- Effects renderer enhancements
- UI panels expanded with repair options


2025-12-27 | Tuning. Nerfing resource gen, cutter combat
--------------------------------------------------------
### Improved
- Balanced resource generation rates
- Nerfed cutter combat stats for better game balance


2025-12-27 | Adds Defend mode
-----------------------------
### New
- Defend game mode with wave spawning system
- Scenario system for different game modes
- Wave spawner system for enemy attacks

### Improved
- UI panels updated for game mode display


2025-12-27 | adds double click to select all of type
----------------------------------------------------
### New
- Double-click to select all units of the same type on screen

### Improved
- Combat system refinements


2025-12-27 | Adds port rally points for newly built ships
---------------------------------------------------------
### New
- Rally points for ports - newly built ships automatically move to rally point
- Rally point visualization in selection UI


2025-12-27 | Adds waves, group selection outline, smoother waypoint changing
----------------------------------------------------------------------------
### New
- Wave renderer for animated water effects
- Group selection outline for multiple selected units

### Improved
- Smoother waypoint changing - ships no longer "pop" when changing direction
- Ship movement interpolation improvements


2025-12-26 | updated ship sprites, foliage added to land
--------------------------------------------------------
### New
- Foliage/vegetation rendering on land tiles
- Attack cursor sprite

### Improved
- Updated ship sprites (cutter, pirate)


2025-12-26 | Adds tower tech tree
---------------------------------
### New
- Tower upgrade tech tree (watchtower -> guard tower -> fortress)
- New tower sprites and stats

### Improved
- Tower combat mechanics
- UI panels for tower upgrades
- New ship sprites (pirate, schooner)


2025-12-26 | Adds custom cursor, updates starting island conditions, build rules
--------------------------------------------------------------------------------
### New
- Custom cursor sprite
- Settlement build rules (adjacency requirements)

### Improved
- Starting island conditions refined
- Trade routes documentation
- Combat system improvements


2025-12-26 | Refactor menu panels
---------------------------------
### Improved
- Major menu panel refactoring
- New UI primitives system for consistent styling
- Cleaner panel code organization


2025-12-26 | large refactor of gameScene into new systems components
--------------------------------------------------------------------
### Improved
- Massive rendering system refactor
- New rendering modules: effectsRenderer, placementUI, selectionUI, tileRenderer, uiPanels, unitRenderer
- Render context and helpers extracted
- gameScene.js significantly simplified


2025-12-26 | Adds destruction effects. updates fog of war
---------------------------------------------------------
### New
- Destruction effects when units are destroyed
- Debris and explosion visuals

### Improved
- Fog of war now only revealed by player units, not pirates
- Pathfinding updates


2025-12-24 | Towers are working. Hotkeys added for build commands
-----------------------------------------------------------------
### New
- Tower defense system with watchtowers
- Hotkeys for build commands
- Tower combat mechanics

### Improved
- Gallery scene updated with towers


2025-12-24 | adds cutter ship sprite. Lots of combat updates. new hex highlight
-------------------------------------------------------------------------------
### New
- Cutter ship sprite and animations
- New hex highlight selection style

### Improved
- Combat system updates
- Ship movement enhancements


2025-12-23 | working combat system with pirates and players
-----------------------------------------------------------
### New
- Complete combat system
- Ship-to-ship combat mechanics
- Combat module (systems/combat.js)

### Improved
- Ship movement with combat integration
- Input handling for attack commands


2025-12-23 | Add pirate ship with AI state machine and health constants
-----------------------------------------------------------------------
### New
- Pirate ship enemy type
- AI state machine for pirates (patrol, chase, attack, flee)
- Health system for ships

### Improved
- Ship sprites with pirate variant
- Fog of war documentation


2025-12-23 | Add animated sea birds and rename farms to settlements
-------------------------------------------------------------------
### New
- Animated sea birds orbiting home port
- Bird sprite

### Improved
- Renamed "farms" to "settlements" throughout codebase
- Settlement building documentation


2025-12-23 | Add project README
-------------------------------
### New
- Project README with setup instructions


2025-12-23 | Refactor gameScene.js into modular systems
-------------------------------------------------------
### New
- Modular systems architecture (construction, inputHandler, resourceGeneration, shipMovement, tradeRoutes)
- CLAUDE.md project context file
- Feature documentation (fog-of-war, port-building, settlement-building, ship-building, trade-routes)
- Game design document

### Improved
- Project reorganized into game/ subdirectory
- gameScene.js split into focused modules


2025-12-22 | Add fog of war, sprites reorganization, and map updates
--------------------------------------------------------------------
### New
- Fog of war system
- Sprites reorganization (colors, farms, ports, ships, utils modules)

### Improved
- Map generation updates


2025-12-22 | Update selection controls: Command+click for waypoints/actions
---------------------------------------------------------------------------
### New
- Multi-unit selection system
- Command+click for waypoints and actions
- Waypoint queuing for ships

### Improved
- Expanded game state management


2025-12-22 | Initial commit: Trade Winds hex-based trading game
---------------------------------------------------------------
### New
- Hex-based game grid with axial coordinates
- Procedural map generation
- A* pathfinding for hex grids
- Ship movement and navigation
- Port and trading system foundation
- Gallery scene for unit showcase
- Kaplay game engine integration
